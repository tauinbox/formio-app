<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/formio.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/formio/formio.js" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.form.js~FormioForm.html">FormioForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.js~Formio.html">Formio</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.wizard.js~FormioWizard.html">FormioWizard</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Components.js~FormioComponents.html">FormioComponents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Validator">Validator</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/address</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/address/Address.js~AddressComponent.html">AddressComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/address/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/base</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/base/Base.js~BaseComponent.html">BaseComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/base/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/button</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/button/Button.js~ButtonComponent.html">ButtonComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/button/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/checkbox</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/checkbox/Checkbox.js~CheckBoxComponent.html">CheckBoxComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/checkbox/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/columns</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/columns/Column.js~ColumnComponent.html">ColumnComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/columns/Columns.js~ColumnsComponent.html">ColumnsComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/columns/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/container</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/container/Container.js~ContainerComponent.html">ContainerComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/container/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/content</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/content/Content.js~ContentComponent.html">ContentComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/content/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/currency</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/currency/Currency.js~CurrencyComponent.html">CurrencyComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/currency/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datagrid</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/datagrid/DataGrid.js~DataGridComponent.html">DataGridComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datagrid/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datetime</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/datetime/DateTime.js~DateTimeComponent.html">DateTimeComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datetime/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/day</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/day/Day.js~DayComponent.html">DayComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/day/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/email</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/email/Email.js~EmailComponent.html">EmailComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/email/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/fieldset</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/fieldset/Fieldset.js~FieldsetComponent.html">FieldsetComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/fieldset/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/form</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/form/Form.js~FormComponent.html">FormComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/form/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/gmap</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/gmap/Gmap.js~GmapComponent.html">GmapComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/gmap/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/hidden</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/hidden/Hidden.js~HiddenComponent.html">HiddenComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/hidden/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/html</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/html/HTML.js~HTMLComponent.html">HTMLComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/html/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/number</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/number/Number.js~NumberComponent.html">NumberComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/number/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/panel</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/panel/Panel.js~PanelComponent.html">PanelComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/panel/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/password</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/password/Password.js~PasswordComponent.html">PasswordComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/password/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/phonenumber</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/phonenumber/PhoneNumber.js~PhoneNumberComponent.html">PhoneNumberComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/phonenumber/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/radio</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/radio/Radio.js~RadioComponent.html">RadioComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/radio/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/resource</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/resource/Resource.js~ResourceComponent.html">ResourceComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/resource/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/select</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/select/Select.js~SelectComponent.html">SelectComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/select/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/selectboxes</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/selectboxes/SelectBoxes.js~SelectBoxesComponent.html">SelectBoxesComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/selectboxes/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/signature</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/signature/Signature.js~SignatureComponent.html">SignatureComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/signature/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/survey</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/survey/Survey.js~SurveyComponent.html">SurveyComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/survey/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/table</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/table/Table.js~TableComponent.html">TableComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/table/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textarea</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/textarea/TextArea.js~TextAreaComponent.html">TextAreaComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textarea/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textfield</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/textfield/TextField.js~TextFieldComponent.html">TextFieldComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textfield/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/unknown</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/unknown/Unknown.js~UnknownComponent.html">UnknownComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/well</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/well/Well.js~WellComponent.html">WellComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/well/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/formio.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

// Intentionally use native-promise-only here... Other promise libraries (es6-promise)
// duck-punch the global Promise definition which messes up Angular 2 since it
// also duck-punches the global Promise definition. For now, keep native-promise-only.
var Promise = require(&quot;native-promise-only&quot;);
require(&apos;whatwg-fetch&apos;);
var EventEmitter = require(&apos;eventemitter2&apos;).EventEmitter2;
var copy = require(&apos;shallow-copy&apos;);

/**
 * The Formio interface class.
 *
 *   let formio = new Formio(&apos;https://examples.form.io/example&apos;);
 */
export class Formio {
  constructor(path, options = {}) {
    // Ensure we have an instance of Formio.
    if (!(this instanceof Formio)) { return new Formio(path); }

    // Initialize our variables.
    this.base = &apos;&apos;;
    this.projectsUrl = &apos;&apos;;
    this.projectUrl = &apos;&apos;;
    this.projectId = &apos;&apos;;
    this.formUrl = &apos;&apos;;
    this.formsUrl = &apos;&apos;;
    this.formId = &apos;&apos;;
    this.submissionsUrl = &apos;&apos;;
    this.submissionUrl = &apos;&apos;;
    this.submissionId = &apos;&apos;;
    this.actionsUrl = &apos;&apos;;
    this.actionId = &apos;&apos;;
    this.actionUrl = &apos;&apos;;
    this.query = &apos;&apos;;

    if (options.hasOwnProperty(&apos;base&apos;)) {
      this.base = options.base;
    }
    else if (Formio.baseUrl) {
      this.base = Formio.baseUrl;
    }
    else {
      this.base = window.location.href.match(/http[s]?:\/\/api./)[0];
    }

    if (!path) {
      // Allow user to create new projects if this was instantiated without
      // a url
      this.projectUrl = this.base + &apos;/project&apos;;
      this.projectsUrl = this.base + &apos;/project&apos;;
      this.projectId = false;
      this.query = &apos;&apos;;
      return;
    }

    if (options.hasOwnProperty(&apos;project&apos;)) {
      this.projectUrl = options.project;
    }

    let project = this.projectUrl || Formio.projectUrl;

    // The baseURL is the same as the projectUrl. This is almost certainly against
    // the Open Source server.
    if (project &amp;&amp; this.base === project) {
      this.noProject = true;
      this.projectUrl = this.base;
    }

    // Normalize to an absolute path.
    if ((path.indexOf(&apos;http&apos;) !== 0) &amp;&amp; (path.indexOf(&apos;//&apos;) !== 0)) {
      path = this.base + path;
    }

    var hostparts = Formio.getUrlParts(path);
    var parts = [];
    var hostName = hostparts[1] + hostparts[2];
    path = hostparts.length &gt; 3 ? hostparts[3] : &apos;&apos;;
    var queryparts = path.split(&apos;?&apos;);
    if (queryparts.length &gt; 1) {
      path = queryparts[0];
      this.query = &apos;?&apos; + queryparts[1];
    }

    // Register a specific path.
    var registerPath = (name, base) =&gt; {
      this[name + &apos;sUrl&apos;] = base + &apos;/&apos; + name;
      var regex = new RegExp(&apos;\/&apos; + name + &apos;\/([^/]+)&apos;);
      if (path.search(regex) !== -1) {
        parts = path.match(regex);
        this[name + &apos;Url&apos;] = parts ? (base + parts[0]) : &apos;&apos;;
        this[name + &apos;Id&apos;] = (parts.length &gt; 1) ? parts[1] : &apos;&apos;;
        base += parts[0];
      }
      return base;
    };

    // Register an array of items.
    var registerItems = function(items, base, staticBase) {
      for (var i in items) {
        if (items.hasOwnProperty(i)) {
          var item = items[i];
          if (item instanceof Array) {
            registerItems(item, base, true);
          }
          else {
            var newBase = registerPath(item, base);
            base = staticBase ? base : newBase;
          }
        }
      }
    };

    if (!this.projectUrl || (this.projectUrl === this.base)) {
      this.projectUrl = hostName;
    }

    if (!this.noProject) {
      // Determine the projectUrl and projectId
      if ((path.search(/(^|\/)(project)($|\/)/) !== -1)) {
        // Get project id as project/:projectId.
        registerItems([&apos;project&apos;], hostName);
      }
      else if (hostName === this.base) {
        // Get project id as first part of path (subdirectory).
        if (hostparts.length &gt; 3 &amp;&amp; path.split(&apos;/&apos;).length &gt; 1) {
          var pathParts = path.split(&apos;/&apos;);
          pathParts.shift(); // Throw away the first /.
          this.projectId = pathParts.shift();
          path = &apos;/&apos; + pathParts.join(&apos;/&apos;);
          this.projectUrl = hostName + &apos;/&apos; + this.projectId;
        }
      }
      else {
        // Get project id from subdomain.
        if (hostparts.length &gt; 2 &amp;&amp; (hostparts[2].split(&apos;.&apos;).length &gt; 2 || hostName.indexOf(&apos;localhost&apos;) !== -1)) {
          this.projectUrl = hostName;
          this.projectId = hostparts[2].split(&apos;.&apos;)[0];
        }
      }
      this.projectsUrl = this.projectsUrl || this.base + &apos;/project&apos;;
    }

    // Configure Form urls and form ids.
    if ((path.search(/(^|\/)(project|form)($|\/)/) !== -1)) {
      registerItems([&apos;form&apos;, [&apos;submission&apos;, &apos;action&apos;]], this.projectUrl);
    }
    else {
      var subRegEx = new RegExp(&apos;\/(submission|action)($|\/.*)&apos;);
      var subs = path.match(subRegEx);
      this.pathType = (subs &amp;&amp; (subs.length &gt; 1)) ? subs[1] : &apos;&apos;;
      path = path.replace(subRegEx, &apos;&apos;);
      path = path.replace(/\/$/, &apos;&apos;);
      this.formsUrl = this.projectUrl + &apos;/form&apos;;
      this.formUrl = this.projectUrl + path;
      this.formId = path.replace(/^\/+|\/+$/g, &apos;&apos;);
      var items = [&apos;submission&apos;, &apos;action&apos;];
      for (var i in items) {
        if (items.hasOwnProperty(i)) {
          var item = items[i];
          this[item + &apos;sUrl&apos;] = this.projectUrl + path + &apos;/&apos; + item;
          if ((this.pathType === item) &amp;&amp; (subs.length &gt; 2) &amp;&amp; subs[2]) {
            this[item + &apos;Id&apos;] = subs[2].replace(/^\/+|\/+$/g, &apos;&apos;);
            this[item + &apos;Url&apos;] = this.projectUrl + path + subs[0];
          }
        }
      }
    }

    // Set the app url if it is not set.
    if (!Formio.projectUrlSet) {
      Formio.projectUrl = this.projectUrl;
    }
  }

  delete(type, opts) {
    var _id = type + &apos;Id&apos;;
    var _url = type + &apos;Url&apos;;
    if (!this[_id]) { Promise.reject(&apos;Nothing to delete&apos;); }
    Formio.cache = {};
    return this.makeRequest(type, this[_url], &apos;delete&apos;, null, opts);
  }

  index(type, query, opts) {
    var _url = type + &apos;Url&apos;;
    query = query || &apos;&apos;;
    if (query &amp;&amp; typeof query === &apos;object&apos;) {
      query = &apos;?&apos; + Formio.serialize(query.params);
    }
    return this.makeRequest(type, this[_url] + query, &apos;get&apos;, null, opts);
  }

  save(type, data, opts) {
    var _id = type + &apos;Id&apos;;
    var _url = type + &apos;Url&apos;;
    var method = (this[_id] || data._id) ? &apos;put&apos; : &apos;post&apos;;
    var reqUrl = this[_id] ? this[_url] : this[type + &apos;sUrl&apos;];
    if (!this[_id] &amp;&amp; data._id &amp;&amp; (method === &apos;put&apos;) &amp;&amp; (reqUrl.indexOf(data._id) === -1)) {
      reqUrl += &apos;/&apos; + data._id;
    }
    Formio.cache = {};
    return this.makeRequest(type, reqUrl + this.query, method, data, opts);
  }

  load(type, query, opts) {
    var _id = type + &apos;Id&apos;;
    var _url = type + &apos;Url&apos;;
    if (query &amp;&amp; typeof query === &apos;object&apos;) {
      query = Formio.serialize(query.params);
    }
    if (query) {
      query = this.query ? (this.query + &apos;&amp;&apos; + query) : (&apos;?&apos; + query);
    }
    else {
      query = this.query;
    }
    if (!this[_id]) { return Promise.reject(&apos;Missing &apos; + _id); }
    return this.makeRequest(type, this[_url] + query, &apos;get&apos;, null, opts);
  }

  makeRequest(type, url, method, data, opts) {
    method = (method || &apos;GET&apos;).toUpperCase();
    if(!opts || typeof opts !== &apos;object&apos;) {
      opts = {};
    }

    var requestArgs = {
      formio: this,
      type: type,
      url: url,
      method: method,
      data: data,
      opts: opts
    };

    var request = Formio.pluginWait(&apos;preRequest&apos;, requestArgs)
      .then(function() {
        return Formio.pluginGet(&apos;request&apos;, requestArgs)
          .then(function(result) {
            if (result === null || result === undefined) {
              return Formio.request(url, method, data, opts.header, opts);
            }
            return result;
          });
      });

    return Formio.pluginAlter(&apos;wrapRequestPromise&apos;, request, requestArgs);
  }

  loadProject(query, opts) {
    return this.load(&apos;project&apos;, query, opts);
  }

  saveProject(data, opts) {
    return this.save(&apos;project&apos;, data, opts);
  }

  deleteProject(opts) {
    return this.delete(&apos;project&apos;, opts);
  }

  static loadProjects(query, opts) {
    query = query || &apos;&apos;;
    if (typeof query === &apos;object&apos;) {
      query = &apos;?&apos; + serialize(query.params);
    }
    return Formio.makeStaticRequest(Formio.baseUrl + &apos;/project&apos; + query);
  }

  loadForm(query, opts) {
    return this.load(&apos;form&apos;, query, opts);
  }

  saveForm(data, opts) {
    return this.save(&apos;form&apos;, data, opts);
  }

  deleteForm(opts) {
    return this.delete(&apos;form&apos;, opts);
  }

  loadForms(query, opts) {
    return this.index(&apos;forms&apos;, query, opts);
  }

  loadSubmission(query, opts) {
    return this.load(&apos;submission&apos;, query, opts);
  }

  saveSubmission(data, opts) {
    return this.save(&apos;submission&apos;, data, opts);
  }

  deleteSubmission(opts) {
    return this.delete(&apos;submission&apos;, opts);
  }

  loadSubmissions(query, opts) {
    return this.index(&apos;submissions&apos;, query, opts);
  }

  loadAction(query, opts) {
    return this.load(&apos;action&apos;, query, opts);
  }

  saveAction(data, opts) {
    return this.save(&apos;action&apos;, data, opts);
  }

  deleteAction(opts) {
    return this.delete(&apos;action&apos;, opts);
  }

  loadActions(query, opts) {
    return this.index(&apos;actions&apos;, query, opts);
  }

  availableActions() {
    return this.makeRequest(&apos;availableActions&apos;, this.formUrl + &apos;/actions&apos;);
  }

  actionInfo(name) {
    return this.makeRequest(&apos;actionInfo&apos;, this.formUrl + &apos;/actions/&apos; + name);
  }

  /**
   * Returns a temporary authentication token for single purpose token generation.
   */
  getTempToken(expire, allowed) {
    var token = Formio.getToken();
    if (!token) {
      return Promise.reject(&apos;You must be authenticated to generate a temporary auth token.&apos;);
    }
    return this.makeRequest(&apos;tempToken&apos;, this.projectUrl + &apos;/token&apos;, &apos;GET&apos;, null, {
      header: new Headers({
        &apos;x-expire&apos;: expire,
        &apos;x-allow&apos;: allowed
      })
    });
  }

  uploadFile(storage, file, fileName, dir, progressCallback, url) {
    var requestArgs = {
      provider: storage,
      method: &apos;upload&apos;,
      file: file,
      fileName: fileName,
      dir: dir
    }
    var request = Formio.pluginWait(&apos;preRequest&apos;, requestArgs)
      .then(function() {
        return Formio.pluginGet(&apos;fileRequest&apos;, requestArgs)
          .then(function(result) {
            if (storage &amp;&amp; (result === null || result === undefined)) {
              if (Formio.providers.storage.hasOwnProperty(storage)) {
                var provider = new Formio.providers.storage[storage](this);
                return provider.uploadFile(file, fileName, dir, progressCallback, url);
              }
              else {
                throw(&apos;Storage provider not found&apos;);
              }
            }
            return result || {url: &apos;&apos;};
          }.bind(this));
      }.bind(this));

    return Formio.pluginAlter(&apos;wrapFileRequestPromise&apos;, request, requestArgs);
  }

  downloadFile(file) {
    var requestArgs = {
      method: &apos;download&apos;,
      file: file
    };

    var request = Formio.pluginWait(&apos;preRequest&apos;, requestArgs)
      .then(function() {
        return Formio.pluginGet(&apos;fileRequest&apos;, requestArgs)
          .then(function(result) {
            if (file.storage &amp;&amp; (result === null || result === undefined)) {
              if (Formio.providers.storage.hasOwnProperty(file.storage)) {
                var provider = new Formio.providers.storage[file.storage](this);
                return provider.downloadFile(file);
              }
              else {
                throw(&apos;Storage provider not found&apos;);
              }
            }
            return result || {url: &apos;&apos;};
          }.bind(this));
      }.bind(this));

    return Formio.pluginAlter(&apos;wrapFileRequestPromise&apos;, request, requestArgs);
  }

  static getUrlParts(url) {
    var regex = &apos;^(http[s]?:\\/\\/)&apos;;
    if (this.base &amp;&amp; url.indexOf(this.base) === 0) {
      regex += &apos;(&apos; + this.base.replace(/^http[s]?:\/\//, &apos;&apos;) + &apos;)&apos;;
    }
    else {
      regex += &apos;([^/]+)&apos;;
    }
    regex += &apos;($|\\/.*)&apos;;
    return url.match(new RegExp(regex));
  }

  static serialize(obj) {
    var str = [];
    for(var p in obj)
      if (obj.hasOwnProperty(p)) {
        str.push(encodeURIComponent(p) + &quot;=&quot; + encodeURIComponent(obj[p]));
      }
    return str.join(&quot;&amp;&quot;);
  }

  static makeStaticRequest(url, method, data, opts) {
    method = (method || &apos;GET&apos;).toUpperCase();
    if(!opts || typeof opts !== &apos;object&apos;) {
      opts = {};
    }
    var requestArgs = {
      url: url,
      method: method,
      data: data
    };

    var request = Formio.pluginWait(&apos;preRequest&apos;, requestArgs)
      .then(function() {
        return Formio.pluginGet(&apos;staticRequest&apos;, requestArgs)
          .then(function(result) {
            if (result === null || result === undefined) {
              return Formio.request(url, method, data, opts.header, opts);
            }
            return result;
          });
      });

    return Formio.pluginAlter(&apos;wrapStaticRequestPromise&apos;, request, requestArgs);
  }

  static request(url, method, data, header, opts) {
    if (!url) {
      return Promise.reject(&apos;No url provided&apos;);
    }
    method = (method || &apos;GET&apos;).toUpperCase();

    // For reverse compatibility, if they provided the ignoreCache parameter,
    // then change it back to the options format where that is a parameter.
    if (typeof opts === &apos;boolean&apos;) {
      opts = {ignoreCache: opts};
    }
    if(!opts || typeof opts !== &apos;object&apos;) {
      opts = {};
    }

    var cacheKey = btoa(url);

    return new Promise(function(resolve, reject) {
      // Get the cached promise to save multiple loads.
      if (!opts.ignoreCache &amp;&amp; method === &apos;GET&apos; &amp;&amp; Formio.cache.hasOwnProperty(cacheKey)) {
        return resolve(Formio.cache[cacheKey]);
      }

      var requestToken = &apos;&apos;;
      resolve(new Promise(function(resolve, reject) {
        // Set up and fetch request
        var headers = header || new Headers({
            &apos;Accept&apos;: &apos;application/json&apos;,
            &apos;Content-type&apos;: &apos;application/json; charset=UTF-8&apos;
          });
        var token = Formio.getToken();
        if (token &amp;&amp; !opts.noToken) {
          headers.append(&apos;x-jwt-token&apos;, token);
        }

        var options = {
          method: method,
          headers: headers,
          mode: &apos;cors&apos;
        };
        if (data) {
          options.body = JSON.stringify(data);
        }

        requestToken = headers.get(&apos;x-jwt-token&apos;);
        resolve(fetch(url, options));
      })
        .catch(function(err) {
          err.message = &apos;Could not connect to API server (&apos; + err.message + &apos;)&apos;;
          err.networkError = true;
          throw err;
        })
        .then(function(response) {
          if (!response.ok) {
            if (response.status === 440) {
              Formio.setToken(null);
              Formio.events.emit(&apos;formio.sessionExpired&apos;, response.body);
            }
            else if (response.status === 401) {
              Formio.events.emit(&apos;formio.unauthorized&apos;, response.body);
            }
            // Parse and return the error as a rejected promise to reject this promise
            return (response.headers.get(&apos;content-type&apos;).indexOf(&apos;application/json&apos;) !== -1 ?
              response.json() : response.text())
              .then(function(error){
                throw error;
              });
          }

          // Handle fetch results
          var token = response.headers.get(&apos;x-jwt-token&apos;);

          // In some strange cases, the fetch library will return an x-jwt-token without sending
          // one to the server. This has even been debugged on the server to verify that no token
          // was introduced with the request, but the response contains a token. This is an Invalid
          // case where we do not send an x-jwt-token and get one in return for any GET request.
          var tokenIntroduced = false;
          if (
            (method === &apos;GET&apos;) &amp;&amp;
            !requestToken &amp;&amp;
            token &amp;&amp;
            (url.indexOf(&apos;token=&apos;) === -1) &amp;&amp;
            (url.indexOf(&apos;x-jwt-token=&apos; === -1))
          ) {
            console.warn(&apos;Token was introduced in request.&apos;);
            tokenIntroduced = true;
          }

          if (
            response.status &gt;= 200 &amp;&amp;
            response.status &lt; 300 &amp;&amp;
            token &amp;&amp;
            token !== &apos;&apos; &amp;&amp;
            !tokenIntroduced
          ) {
            Formio.setToken(token);
          }
          // 204 is no content. Don&apos;t try to .json() it.
          if (response.status === 204) {
            return {};
          }
          return (response.headers.get(&apos;content-type&apos;).indexOf(&apos;application/json&apos;) !== -1
              ? response.json()
              : response.text()
          ).then(function(result) {
            // Add some content-range metadata to the result here
            var range = response.headers.get(&apos;content-range&apos;);
            if (range &amp;&amp; typeof result === &apos;object&apos;) {
              range = range.split(&apos;/&apos;);
              if(range[0] !== &apos;*&apos;) {
                var skipLimit = range[0].split(&apos;-&apos;);
                result.skip = Number(skipLimit[0]);
                result.limit = skipLimit[1] - skipLimit[0] + 1;
              }
              result.serverCount = range[1] === &apos;*&apos; ? range[1] : Number(range[1]);
            }

            if (!opts.getHeaders) {
              return result;
            }

            var headers = {};
            response.headers.forEach(function(item, key) {
              headers[key] = item;
            });

            return new Promise(function(resolve, reject) {
              resolve({result: result, headers: headers});
            });
          });
        })
        .catch(function(err) {
          if (err === &apos;Bad Token&apos;) {
            Formio.setToken(null);
            Formio.events.emit(&apos;formio.badToken&apos;, err);
          }
          if (Formio.cache.hasOwnProperty(cacheKey)) {
            // Remove failed promises from cache
            delete Formio.cache[cacheKey];
          }
          // Propagate error so client can handle accordingly
          throw err;
        }));
    })
      .then(function(result) {
        // Save the cache
        if (method === &apos;GET&apos;) {
          Formio.cache[cacheKey] = Promise.resolve(result);
        }

        // Shallow copy result so modifications don&apos;t end up in cache
        if(Array.isArray(result)) {
          var resultCopy = result.map(copy);
          resultCopy.skip = result.skip;
          resultCopy.limit = result.limit;
          resultCopy.serverCount = result.serverCount;
          return resultCopy;
        }
        return copy(result);
      });
  }

  static setToken(token) {
    token = token || &apos;&apos;;
    if (token === this.token) { return; }
    this.token = token;
    if (!token) {
      Formio.setUser(null);
      // iOS in private browse mode will throw an error but we can&apos;t detect ahead of time that we are in private mode.
      try {
        return localStorage.removeItem(&apos;formioToken&apos;);
      }
      catch(err) {
        return;
      }
    }
    // iOS in private browse mode will throw an error but we can&apos;t detect ahead of time that we are in private mode.
    try {
      localStorage.setItem(&apos;formioToken&apos;, token);
    }
    catch(err) {
      // Do nothing.
    }
    return Formio.currentUser(); // Run this so user is updated if null
  }

  static getToken() {
    if (this.token) { return this.token; }
    try {
      var token = localStorage.getItem(&apos;formioToken&apos;) || &apos;&apos;;
      this.token = token;
      return token;
    }
    catch (e) {
      return &apos;&apos;;
    }
  }

  static setUser(user) {
    if (!user) {
      this.setToken(null);
      // iOS in private browse mode will throw an error but we can&apos;t detect ahead of time that we are in private mode.
      try {
        return localStorage.removeItem(&apos;formioUser&apos;);
      }
      catch(err) {
        return;
      }
    }
    // iOS in private browse mode will throw an error but we can&apos;t detect ahead of time that we are in private mode.
    try {
      localStorage.setItem(&apos;formioUser&apos;, JSON.stringify(user));
    }
    catch(err) {
      // Do nothing.
    }
  }

  static getUser() {
    try {
      return JSON.parse(localStorage.getItem(&apos;formioUser&apos;) || null);
    }
    catch (e) {
      return;
    }
  }

  static setBaseUrl(url) {
    Formio.baseUrl = url;
    if (!Formio.projectUrlSet) {
      Formio.projectUrl = url;
    }
  }

  static getBaseUrl() {
    return Formio.baseUrl;
  }

  static setApiUrl(url) {
    return Formio.setBaseUrl(url);
  }

  static getApiUrl() {
    return Formio.getBaseUrl();
  }

  static setAppUrl(url) {
    console.warn(&apos;Formio.setAppUrl() is deprecated. Use Formio.setProjectUrl instead.&apos;)
    Formio.projectUrl = url;
    Formio.projectUrlSet = true;
  }

  static setProjectUrl(url) {
    Formio.projectUrl = url;
    Formio.projectUrlSet = true;
  }

  static getAppUrl() {
    console.warn(&apos;Formio.getAppUrl() is deprecated. Use Formio.getProjectUrl instead.&apos;)
    return Formio.projectUrl;
  }

  static getProjectUrl() {
    return Formio.projectUrl;
  }

  static clearCache() {
    Formio.cache = {};
  }

  static noop() {}
  static identity(value) { return value; }

  static deregisterPlugin(plugin) {
    var beforeLength = Formio.plugins.length;
    Formio.plugins = Formio.plugins.filter(function(p) {
      if(p !== plugin &amp;&amp; p.__name !== plugin) return true;
      (p.deregister || Formio.noop).call(p, Formio);
      return false;
    });
    return beforeLength !== Formio.plugins.length;
  }

  static registerPlugin(plugin, name) {
    Formio.plugins.push(plugin);
    Formio.plugins.sort(function(a, b) {
      return (b.priority || 0) - (a.priority || 0);
    });
    plugin.__name = name;
    (plugin.init || Formio.noop).call(plugin, Formio);
  }

  static getPlugin(name) {
    return Formio.plugins.reduce(function(result, plugin) {
      if (result) return result;
      if (plugin.__name === name) return plugin;
    }, null);
  }

  static pluginWait(pluginFn) {
    var args = [].slice.call(arguments, 1);
    return Promise.all(Formio.plugins.map(function(plugin) {
      return (plugin[pluginFn] || Formio.noop).apply(plugin, args);
    }));
  }

  static pluginGet(pluginFn) {
    var args = [].slice.call(arguments, 0);
    var callPlugin = function(index, pluginFn) {
      var plugin = Formio.plugins[index];
      if (!plugin) return Promise.resolve(null);
      return Promise.resolve((plugin &amp;&amp; plugin[pluginFn] || Formio.noop).apply(plugin, [].slice.call(arguments, 2)))
        .then(function(result) {
          if (result !== null &amp;&amp; result !== undefined) return result;
          return callPlugin.apply(null, [index + 1].concat(args));
        });
    };
    return callPlugin.apply(null, [0].concat(args));
  }

  static pluginAlter(pluginFn, value) {
    var args = [].slice.call(arguments, 2);
    return Formio.plugins.reduce(function(value, plugin) {
      return (plugin[pluginFn] || Formio.identity).apply(plugin, [value].concat(args));
    }, value);
  }

  static currentUser() {
    var url = Formio.baseUrl + &apos;/current&apos;;
    var user = this.getUser();
    if (user) {
      return Formio.pluginAlter(&apos;wrapStaticRequestPromise&apos;, Promise.resolve(user), {
        url: url,
        method: &apos;GET&apos;
      })
    }
    var token = this.getToken();
    if (!token) {
      return Formio.pluginAlter(&apos;wrapStaticRequestPromise&apos;, Promise.resolve(null), {
        url: url,
        method: &apos;GET&apos;
      })
    }
    return Formio.makeStaticRequest(url)
      .then(function(response) {
        Formio.setUser(response);
        return response;
      });
  }

  static logout() {
    Formio.setToken(null);
    Formio.setUser(null);
    Formio.clearCache();
    return Formio.makeStaticRequest(Formio.baseUrl + &apos;/logout&apos;);
  }

  /**
   * Attach an HTML form to Form.io.
   *
   * @param form
   */
  static form(form, options, done) {
    // Fix the parameters.
    if (!done &amp;&amp; typeof options === &apos;function&apos;) {
      done = options;
      options = {};
    }

    done = done || (function() { console.log(arguments); });
    options = options || {};

    // IF they provide a jquery object, then select the element.
    if (form.jquery) { form = form[0]; }
    if (!form) {
      return done(&apos;Invalid Form&apos;);
    }

    var getAction = function() {
      return options.form || form.getAttribute(&apos;action&apos;);
    };

    /**
     * Returns the current submission object.
     * @returns {{data: {}}}
     */
    var getSubmission = function() {
      var submission = {data: {}};
      var setValue = function(path, value) {
        var isArray = path.substr(-2) === &apos;[]&apos;;
        if (isArray) {
          path = path.replace(&apos;[]&apos;, &apos;&apos;);
        }
        var paths = path.replace(/\[|\]\[/g, &apos;.&apos;).replace(/\]$/g, &apos;&apos;).split(&apos;.&apos;);
        var current = submission;
        while (path = paths.shift()) {
          if (!paths.length) {
            if (isArray) {
              if (!current[path]) {
                current[path] = [];
              }
              current[path].push(value);
            }
            else {
              current[path] = value;
            }
          }
          else {
            if (!current[path]) {
              current[path] = {};
            }
            current = current[path];
          }
        }
      };

      // Get the form data from this form.
      var formData = new FormData(form);
      var entries = formData.entries();
      var entry = null;
      while (entry = entries.next().value) {
        setValue(entry[0], entry[1]);
      }
      return submission;
    };

    // Submits the form.
    var submit = function(event) {
      if (event) {
        event.preventDefault();
      }
      var action = getAction();
      if (!action) {
        return;
      }
      (new Formio(action)).saveSubmission(getSubmission()).then(function(sub) {
        done(null, sub);
      }, done);
    };

    // Attach formio to the provided form.
    if (form.attachEvent) {
      form.attachEvent(&apos;submit&apos;, submit);
    } else {
      form.addEventListener(&apos;submit&apos;, submit);
    }

    return {
      submit: submit,
      getAction: getAction,
      getSubmission: getSubmission
    };
  }

  static fieldData(data, component) {
    if (!data) { return &apos;&apos;; }
    if (!component || !component.key) { return data; }
    if (component.key.indexOf(&apos;.&apos;) !== -1) {
      var value = data;
      var parts = component.key.split(&apos;.&apos;);
      var key = &apos;&apos;;
      for (var i = 0; i &lt; parts.length; i++) {
        key = parts[i];

        // Handle nested resources
        if (value.hasOwnProperty(&apos;_id&apos;)) {
          value = value.data;
        }

        // Return if the key is not found on the value.
        if (!value.hasOwnProperty(key)) {
          return;
        }

        // Convert old single field data in submissions to multiple
        if (key === parts[parts.length - 1] &amp;&amp; component.multiple &amp;&amp; !Array.isArray(value[key])) {
          value[key] = [value[key]];
        }

        // Set the value of this key.
        value = value[key];
      }
      return value;
    }
    else {
      // Convert old single field data in submissions to multiple
      if (component.multiple &amp;&amp; !Array.isArray(data[component.key])) {
        data[component.key] = [data[component.key]];
      }
      return data[component.key];
    }
  }
}

// Define all the static properties.
Formio.baseUrl = &apos;https://api.form.io&apos;;
Formio.projectUrl = Formio.baseUrl;
Formio.projectUrlSet = false;
Formio.plugins = [];
Formio.cache = {};
Formio.providers = require(&apos;./providers&apos;);
Formio.events = new EventEmitter({
  wildcard: false,
  maxListeners: 0
});

module.exports = global.Formio = Formio;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
