<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/formio.spec.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/formio/formio.js" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.form.js~FormioForm.html">FormioForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.js~Formio.html">Formio</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/formio.wizard.js~FormioWizard.html">FormioWizard</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Components.js~FormioComponents.html">FormioComponents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Validator">Validator</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/address</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/address/Address.js~AddressComponent.html">AddressComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/address/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/base</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/base/Base.js~BaseComponent.html">BaseComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/base/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/button</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/button/Button.js~ButtonComponent.html">ButtonComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/button/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/checkbox</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/checkbox/Checkbox.js~CheckBoxComponent.html">CheckBoxComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/checkbox/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/columns</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/columns/Column.js~ColumnComponent.html">ColumnComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/columns/Columns.js~ColumnsComponent.html">ColumnsComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/columns/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/container</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/container/Container.js~ContainerComponent.html">ContainerComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/container/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/content</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/content/Content.js~ContentComponent.html">ContentComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/content/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/currency</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/currency/Currency.js~CurrencyComponent.html">CurrencyComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/currency/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datagrid</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/datagrid/DataGrid.js~DataGridComponent.html">DataGridComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datagrid/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datetime</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/datetime/DateTime.js~DateTimeComponent.html">DateTimeComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/datetime/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/day</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/day/Day.js~DayComponent.html">DayComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/day/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/email</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/email/Email.js~EmailComponent.html">EmailComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/email/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/fieldset</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/fieldset/Fieldset.js~FieldsetComponent.html">FieldsetComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/fieldset/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/gmap</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/gmap/Gmap.js~GmapComponent.html">GmapComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/gmap/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/hidden</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/hidden/Hidden.js~HiddenComponent.html">HiddenComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/hidden/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/html</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/html/HTML.js~HTMLComponent.html">HTMLComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/html/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/number</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/number/Number.js~NumberComponent.html">NumberComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/number/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/panel</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/panel/Panel.js~PanelComponent.html">PanelComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/panel/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/password</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/password/Password.js~PasswordComponent.html">PasswordComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/password/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/phonenumber</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/phonenumber/PhoneNumber.js~PhoneNumberComponent.html">PhoneNumberComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/phonenumber/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/radio</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/radio/Radio.js~RadioComponent.html">RadioComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/radio/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/resource</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/resource/Resource.js~ResourceComponent.html">ResourceComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/resource/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/select</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/select/Select.js~SelectComponent.html">SelectComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/select/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/selectboxes</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/selectboxes/SelectBoxes.js~SelectBoxesComponent.html">SelectBoxesComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/selectboxes/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/signature</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/signature/Signature.js~SignatureComponent.html">SignatureComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/signature/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/survey</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/survey/Survey.js~SurveyComponent.html">SurveyComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/survey/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/table</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/table/Table.js~TableComponent.html">TableComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/table/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textarea</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/textarea/TextArea.js~TextAreaComponent.html">TextAreaComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textarea/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textfield</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/textfield/TextField.js~TextFieldComponent.html">TextFieldComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/textfield/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/unknown</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/unknown/Unknown.js~UnknownComponent.html">UnknownComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/well</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/well/Well.js~WellComponent.html">WellComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/well/fixtures</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-component">component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-components">components</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/formio.spec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;
import Formio from &apos;./formio&apos;;
import _each from &apos;lodash/each&apos;;
import assert from &apos;power-assert&apos;;
import sinon from &apos;sinon&apos;;
import Chance from &apos;chance&apos;;
import fetchMock from &apos;fetch-mock/es5/client&apos;;
import _ from &apos;lodash&apos;;

let chance = Chance();
let protocol = &apos;https&apos;;
let domain = &apos;localhost:3000&apos;;
let baseUrl = protocol + &apos;://api.&apos; + domain;
Formio.setBaseUrl(baseUrl);
Formio.setToken(null);

var generateID = function() {
  return chance.string({length: 24, pool: &apos;0123456789abcdef&apos;});
};

var runTests = function(cb, options) {
  var tests = {};
  var noBefore = cb(tests);
  if (!noBefore) {
    beforeEach(() =&gt; {
      Formio.setBaseUrl(baseUrl);
      Formio.projectUrlSet = false;
      Formio.projectUrl = &apos;https://api.form.io&apos;;
    });
  }
  _each(tests, function(test, path) {
    it (&apos;Should initialize for &apos; + path, function(done) {
      if (typeof test === &apos;function&apos;) {
        test();
      }
      else {
        var formio = new Formio(path, options);
        for (var param in test) {
          assert.equal(formio[param], test[param], param + &apos; is not equal. &apos; + formio[param] + &apos; == &apos; + test[param] + &apos;\n&apos;);
        }
      }
      done();
    });
  });
};

describe(&apos;Formio Constructor Tests&apos;, () =&gt; {
  runTests((tests) =&gt; {
    tests[&apos;http://form.io/project/234234234234/form/23234234234234&apos;] = {
      projectUrl: &apos;http://form.io/project/234234234234&apos;,
      projectsUrl: &apos;http://form.io/project&apos;,
      projectId: &apos;234234234234&apos;,
      formsUrl: &apos;http://form.io/project/234234234234/form&apos;,
      formUrl: &apos;http://form.io/project/234234234234/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/project/234234234234/form/23234234234234/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://form.io/project/234234234234/form/23234234234234/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/form/23234234234234&apos;] = {
      projectUrl: &apos;http://form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;&apos;,
      formsUrl: &apos;http://form.io/form&apos;,
      formUrl: &apos;http://form.io/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/form/23234234234234/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://form.io/form/23234234234234/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/form/23234234234234/submission/982398220983&apos;] = {
      projectUrl: &apos;http://form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;&apos;,
      formsUrl: &apos;http://form.io/form&apos;,
      formUrl: &apos;http://form.io/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/form/23234234234234/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://form.io/form/23234234234234/submission&apos;,
      submissionUrl: &apos;http://form.io/form/23234234234234/submission/982398220983&apos;,
      submissionId: &apos;982398220983&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/form/23234234234234/action/234230987872&apos;] = {
      projectUrl: &apos;http://form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;&apos;,
      formsUrl: &apos;http://form.io/form&apos;,
      formUrl: &apos;http://form.io/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/form/23234234234234/action&apos;,
      actionUrl: &apos;http://form.io/form/23234234234234/action/234230987872&apos;,
      actionId: &apos;234230987872&apos;,
      submissionsUrl: &apos;http://form.io/form/23234234234234/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/project/092934882/form/23234234234234/action/234230987872&apos;] = {
      projectUrl: &apos;http://form.io/project/092934882&apos;,
      projectsUrl: &apos;http://form.io/project&apos;,
      projectId: &apos;092934882&apos;,
      formsUrl: &apos;http://form.io/project/092934882/form&apos;,
      formUrl: &apos;http://form.io/project/092934882/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/action&apos;,
      actionUrl: &apos;http://form.io/project/092934882/form/23234234234234/action/234230987872&apos;,
      actionId: &apos;234230987872&apos;,
      submissionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://api.form.io/project/092934882&apos;] = {
      projectUrl: &apos;http://api.form.io/project/092934882&apos;,
      projectsUrl: &apos;http://api.form.io/project&apos;,
      projectId: &apos;092934882&apos;,
      formsUrl: &apos;http://api.form.io/project/092934882/form&apos;,
      formUrl: &apos;&apos;,
      formId: &apos;&apos;,
      actionsUrl: &apos;http://api.form.io/project/092934882/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://api.form.io/project/092934882/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/project/092934882/form/23234234234234/submission/2987388987982&apos;] = {
      projectUrl: &apos;http://form.io/project/092934882&apos;,
      projectsUrl: &apos;http://form.io/project&apos;,
      projectId: &apos;092934882&apos;,
      formsUrl: &apos;http://form.io/project/092934882/form&apos;,
      formUrl: &apos;http://form.io/project/092934882/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/submission&apos;,
      submissionUrl: &apos;http://form.io/project/092934882/form/23234234234234/submission/2987388987982&apos;,
      submissionId: &apos;2987388987982&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://form.io/project/092934882/form/23234234234234?test=hello&amp;test2=there&apos;] = {
      projectUrl: &apos;http://form.io/project/092934882&apos;,
      projectsUrl: &apos;http://form.io/project&apos;,
      projectId: &apos;092934882&apos;,
      formsUrl: &apos;http://form.io/project/092934882/form&apos;,
      formUrl: &apos;http://form.io/project/092934882/form/23234234234234&apos;,
      formId: &apos;23234234234234&apos;,
      actionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://form.io/project/092934882/form/23234234234234/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=hello&amp;test2=there&apos;
    };
    tests[&apos;http://project.form.io/user/login&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/login&apos;,
      formId: &apos;user/login&apos;,
      actionsUrl: &apos;http://project.form.io/user/login/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/login/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user/login/submission/234234243234&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/login&apos;,
      formId: &apos;user/login&apos;,
      actionsUrl: &apos;http://project.form.io/user/login/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/login/submission&apos;,
      submissionUrl: &apos;http://project.form.io/user/login/submission/234234243234&apos;,
      submissionId: &apos;234234243234&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user/login/action/234234243234&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/login&apos;,
      formId: &apos;user/login&apos;,
      actionsUrl: &apos;http://project.form.io/user/login/action&apos;,
      actionUrl: &apos;http://project.form.io/user/login/action/234234243234&apos;,
      actionId: &apos;234234243234&apos;,
      submissionsUrl: &apos;http://project.form.io/user/login/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user/login/action/234234243234?test=test2&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/login&apos;,
      formId: &apos;user/login&apos;,
      actionsUrl: &apos;http://project.form.io/user/login/action&apos;,
      actionUrl: &apos;http://project.form.io/user/login/action/234234243234&apos;,
      actionId: &apos;234234243234&apos;,
      submissionsUrl: &apos;http://project.form.io/user/login/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=test2&apos;
    };
    tests[&apos;http://project.form.io/user/loginform/action/234234243234?test=test2&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/loginform&apos;,
      formId: &apos;user/loginform&apos;,
      actionsUrl: &apos;http://project.form.io/user/loginform/action&apos;,
      actionUrl: &apos;http://project.form.io/user/loginform/action/234234243234&apos;,
      actionId: &apos;234234243234&apos;,
      submissionsUrl: &apos;http://project.form.io/user/loginform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=test2&apos;
    };
    tests[&apos;http://project.form.io/user/loginform/submission&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/loginform&apos;,
      formId: &apos;user/loginform&apos;,
      actionsUrl: &apos;http://project.form.io/user/loginform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/loginform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user&apos;,
      formId: &apos;user&apos;,
      actionsUrl: &apos;http://project.form.io/user/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user/actionform/submission/2342424234234&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: &apos;http://project.form.io/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/actionform/submission&apos;,
      submissionUrl: &apos;http://project.form.io/user/actionform/submission/2342424234234&apos;,
      submissionId: &apos;2342424234234&apos;,
      query: &apos;&apos;
    };
    tests[&apos;http://project.form.io/user/actionform/?test=foo&apos;] = {
      projectUrl: &apos;http://project.form.io&apos;,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: &apos;project&apos;,
      formsUrl: &apos;http://project.form.io/form&apos;,
      formUrl: &apos;http://project.form.io/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: &apos;http://project.form.io/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;http://project.form.io/user/actionform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=foo&apos;
    }
  });
});

describe(&apos;Localhost Constructor Tests&apos;, () =&gt; {
  var testBaseUrl = &apos;localhost:3000&apos;;
  var projectName = &apos;myproject&apos;;
  var projectUrl = protocol + &apos;://&apos; + projectName + &apos;.&apos; + testBaseUrl;
  runTests((tests) =&gt; {
    tests[projectUrl + &apos;/user/actionform/?test=foo&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: projectUrl + &apos;/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/actionform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=foo&apos;
    };
    tests[projectUrl + &apos;/user&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user&apos;,
      formId: &apos;user&apos;,
      actionsUrl: projectUrl + &apos;/user/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
  }, { base: baseUrl });
});

describe(&apos;Subdomain Constructor Tests&apos;, () =&gt; {
  var testBaseUrl = &apos;foo.blah.form.io&apos;;
  var projectName = &apos;myproject&apos;;
  var projectUrl = protocol + &apos;://&apos; + projectName + &apos;.&apos; + testBaseUrl;
  runTests((tests) =&gt; {
    tests[projectUrl + &apos;/user/actionform/?test=foo&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: projectUrl + &apos;/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/actionform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=foo&apos;
    };
    tests[projectUrl + &apos;/user&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: baseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user&apos;,
      formId: &apos;user&apos;,
      actionsUrl: projectUrl + &apos;/user/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
  }, { base: baseUrl });
});

describe(&apos;Subdirectory Constructor Tests&apos;, () =&gt; {
  var testBaseUrl = &apos;foo.blah.form.io&apos;;
  var projectName = &apos;myproject&apos;;
  var projectUrl = protocol + &apos;://&apos; + testBaseUrl + &apos;/&apos; + projectName;
  runTests((tests) =&gt; {
    tests[projectUrl + &apos;/user/actionform/?test=foo&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: protocol + &apos;://&apos; + testBaseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: projectUrl + &apos;/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/actionform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=foo&apos;
    };
    tests[projectUrl + &apos;/user&apos;] = {
      projectUrl: projectUrl,
      projectsUrl: protocol + &apos;://&apos; + testBaseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl + &apos;/user&apos;,
      formId: &apos;user&apos;,
      actionsUrl: projectUrl + &apos;/user/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/user/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[projectUrl] = {
      projectUrl: projectUrl,
      projectsUrl: protocol + &apos;://&apos; + testBaseUrl + &apos;/project&apos;,
      projectId: projectName,
      formsUrl: projectUrl + &apos;/form&apos;,
      formUrl: projectUrl,
      formId: &apos;&apos;,
      actionsUrl: projectUrl + &apos;/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: projectUrl + &apos;/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
  }, { base: protocol + &apos;://&apos; + testBaseUrl});
});

describe(&apos;Simple Form Constructor Tests&apos;, () =&gt; {
  runTests((tests) =&gt; {
    tests[&apos;init&apos;] = () =&gt; {
      Formio.setBaseUrl(&apos;https://api.form.io&apos;);
      Formio.projectUrlSet = false;
      Formio.projectUrl = &apos;https://api.form.io&apos;;
    };
    tests[&apos;https://examples.form.io/example&apos;] = {
      projectUrl: &apos;https://examples.form.io&apos;,
      projectsUrl: &apos;&apos;,
      projectId: &apos;&apos;,
      formsUrl: &apos;https://examples.form.io/form&apos;,
      formUrl: &apos;https://examples.form.io/example&apos;,
      formId: &apos;example&apos;,
      actionsUrl: &apos;https://examples.form.io/example/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: &apos;https://examples.form.io/example/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    return true;
  });
});

describe(&apos;Open Source Constructor Tests&apos;, () =&gt; {
  const formBaseUrl = &apos;http://localhost:3000&apos;;
  runTests((tests) =&gt; {
    tests[formBaseUrl + &apos;/user&apos;] = {
      projectUrl: formBaseUrl,
      projectsUrl: &apos;&apos;,
      projectId: &apos;&apos;,
      formsUrl: formBaseUrl + &apos;/form&apos;,
      formUrl: formBaseUrl + &apos;/user&apos;,
      formId: &apos;user&apos;,
      actionsUrl: formBaseUrl + &apos;/user/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: formBaseUrl + &apos;/user/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;&apos;
    };
    tests[formBaseUrl + &apos;/user/actionform/?test=foo&apos;] = {
      projectUrl: formBaseUrl,
      projectsUrl: &apos;&apos;,
      projectId: &apos;&apos;,
      formsUrl: formBaseUrl + &apos;/form&apos;,
      formUrl: formBaseUrl + &apos;/user/actionform&apos;,
      formId: &apos;user/actionform&apos;,
      actionsUrl: formBaseUrl + &apos;/user/actionform/action&apos;,
      actionUrl: &apos;&apos;,
      actionId: &apos;&apos;,
      submissionsUrl: formBaseUrl + &apos;/user/actionform/submission&apos;,
      submissionUrl: &apos;&apos;,
      submissionId: &apos;&apos;,
      query: &apos;?test=foo&apos;
    };
  }, {base: formBaseUrl, project: formBaseUrl});
});

describe(&apos;Plugins&apos;, () =&gt; {
  var plugin = null;
  beforeEach(() =&gt; {
    assert.equal(Formio.getPlugin(&apos;test-plugin&apos;), undefined, &apos;No plugin may be returned under the name `test-plugin`&apos;);
    plugin = {init: sinon.spy()};
    Formio.registerPlugin(plugin, &apos;test-plugin&apos;);
    assert.ok(plugin.init.calledOnce, &apos;plugin.init must be called exactly once&apos;);
    assert.ok(plugin.init.calledOn(plugin), &apos;plugin.init must be called on plugin as `this`&apos;);
    assert.ok(plugin.init.calledWithExactly(Formio), &apos;plugin.init must be given Formio as argument&apos;);
    assert.equal(Formio.getPlugin(&apos;test-plugin&apos;), plugin, &apos;getPlugin must return plugin&apos;);
  });

  afterEach(() =&gt; {
    assert.equal(Formio.getPlugin(&apos;test-plugin&apos;), plugin, &apos;getPlugin must return plugin&apos;);
    plugin.deregister = sinon.spy();
    Formio.deregisterPlugin(plugin, &apos;test-plugin&apos;);
    assert.ok(plugin.deregister.calledOnce, &apos;plugin.deregister must be called exactly once&apos;);
    assert.ok(plugin.deregister.calledOn(plugin), &apos;plugin.deregister must be called on plugin as `this`&apos;);
    assert.ok(plugin.deregister.calledWithExactly(Formio), &apos;plugin.deregister must be given Formio as argument&apos;);
    assert.equal(Formio.getPlugin(&apos;test-plugin&apos;), undefined, &apos;No plugin may be returned under the name `test-plugin`&apos;);
  });

  // Test a request to see if the plugin flow order is correct
  var testRequest = function testRequest(url, method, type) {
    var fnName;
    switch (method) {
      case &apos;GET&apos;: fnName = &apos;load&apos; + _.capitalize(type); break;
      case &apos;POST&apos;:
      case &apos;PUT&apos;: fnName = &apos;save&apos; + _.capitalize(type); break;
      case &apos;DELETE&apos;: fnName = &apos;delete&apos; + _.capitalize(type); break;
    }

    it(&apos;Plugin &apos; + method + &apos; &apos; + fnName, function(done) {
      let step = 0;
      var formio = new Formio(url);
      method = method.toUpperCase();
      var testData = {testRequest: &apos;TEST_REQUEST&apos;};
      var testOpts = {testOption: true};
      var testResult = {_id: &apos;TEST_ID&apos;, testResult: &apos;TEST_RESULT&apos;};

      var expectedArgs = {
        formio: formio,
        type: type,
        method: method,
        url: formio[type + (method === &apos;POST&apos; ? &apos;sUrl&apos; : &apos;Url&apos;)],
        data: _.startsWith(fnName, &apos;save&apos;) ? testData : null,
        opts: testOpts
      };

      // Set up plugin hooks
      plugin.preRequest = function(requestArgs) {
        assert.equal(++step, 1, &apos;preRequest hook should be called first&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 3, &apos;preRequest promise should resolve third&apos;);
            // TODO
          });
      };
      plugin.request = function(requestArgs) {
        assert.equal(++step, 4, &apos;request hook should be called fourth&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 5, &apos;request promise should resolve fifth&apos;);
            return testResult;
          });
      };
      plugin.wrapRequestPromise = function(promise, requestArgs) {
        assert.equal(++step, 2, &apos;wrapRequestPromise hook should be called second&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return promise.then(function(result) {
          assert.equal(++step, 6, &apos;wrapRequestPromise post-result promise should resolve sixth&apos;);
          assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
          return result;
        });
      };

      var promise;
      if (_.startsWith(fnName, &apos;save&apos;)) {
        promise = formio[fnName](testData, testOpts);
      }
      else if (_.startsWith(fnName, &apos;load&apos;)) {
        promise = formio[fnName](null, testOpts);
      }
      else {
        promise = formio[fnName](testOpts);
      }
      promise.then(function(result) {
        assert.equal(++step, 7, &apos;post request promise should resolve last&apos;);
        assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
        done();
      });
    });
  };

  var tests = [
    {
      url: &apos;https://api.localhost:3000/project/myproject&apos;,
      method: &apos;GET&apos;,
      type: &apos;project&apos;
    },
    {
      url: &apos;&apos;,
      method: &apos;POST&apos;,
      type: &apos;project&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject&apos;,
      method: &apos;PUT&apos;,
      type: &apos;project&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject&apos;,
      method: &apos;DELETE&apos;,
      type: &apos;project&apos;
    },

    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;GET&apos;,
      type: &apos;form&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject&apos;,
      method: &apos;POST&apos;,
      type: &apos;form&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;PUT&apos;,
      type: &apos;form&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;DELETE&apos;,
      type: &apos;form&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/&apos;,
      method: &apos;GET&apos;,
      type: &apos;forms&apos;
    },

    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/submission/76543210FEDCBA9876543210&apos;,
      method: &apos;GET&apos;,
      type: &apos;submission&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;POST&apos;,
      type: &apos;submission&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/submission/76543210FEDCBA9876543210&apos;,
      method: &apos;PUT&apos;,
      type: &apos;submission&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/submission/76543210FEDCBA9876543210&apos;,
      method: &apos;DELETE&apos;,
      type: &apos;submission&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;GET&apos;,
      type: &apos;submissions&apos;
    },

    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/action/76543210FEDCBA9876543210&apos;,
      method: &apos;GET&apos;,
      type: &apos;action&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;POST&apos;,
      type: &apos;action&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/action/76543210FEDCBA9876543210&apos;,
      method: &apos;PUT&apos;,
      type: &apos;action&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567/action/76543210FEDCBA9876543210&apos;,
      method: &apos;DELETE&apos;,
      type: &apos;action&apos;
    },
    {
      url: &apos;https://api.localhost:3000/project/myproject/form/0123456789ABCDEF01234567&apos;,
      method: &apos;GET&apos;,
      type: &apos;actions&apos;
    }
  ];

  tests.forEach(function(test) {
    testRequest(test.url, test.method, test.type);
  });

  var testStaticRequest = function testStaticRequest(fnName, url, method, data) {
    it(&apos;Plugin &apos; + fnName, function(done) {
      var step = 0;
      var testResult = {_id: &apos;TEST_ID&apos;, testResult: &apos;TEST_RESULT&apos;};
      var expectedArgs = {
        url: url,
        method: method,
        data: data
      };

      // Set up plugin hooks
      plugin.preRequest = function(requestArgs) {
        assert.equal(++step, 1, &apos;preRequest hook should be called first&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 3, &apos;preRequest promise should resolve third&apos;);
            // TODO
          });
      };
      plugin.staticRequest = function(requestArgs) {
        assert.equal(++step, 4, &apos;request hook should be called fourth&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 5, &apos;request promise should resolve fifth&apos;);
            return testResult;
          });
      };
      plugin.wrapStaticRequestPromise = function(promise, requestArgs) {
        assert.equal(++step, 2, &apos;wrapRequestPromise hook should be called second&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return promise.then(function(result) {
          assert.equal(++step, 6, &apos;wrapRequestPromise post-result promise should resolve sixth&apos;);
          assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
          return result;
        });
      };

      Formio[fnName]()
        .then(function(result) {
          assert.equal(++step, 7, &apos;post request promise should resolve last&apos;);
          assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
          done();
        });
    });
  };

  var staticTests = [
    {
      fnName: &apos;loadProjects&apos;,
      url: &apos;https://api.localhost:3000/project&apos;,
      method: &apos;GET&apos;,
      data: undefined
    },
    {
      fnName: &apos;logout&apos;,
      url: &apos;https://api.localhost:3000/logout&apos;,
      method: &apos;GET&apos;,
      data: undefined
    }
  ];

  staticTests.forEach(function(test) {
    testStaticRequest(test.fnName, test.url, test.method, test.type);
  });

  var testFileRequest = function testFileRequest(fnName, formUrl, args) {
    it(&apos;Plugin &apos; + fnName, function(done) {
      var step = 0;
      var testResult = {_id: &apos;TEST_ID&apos;, testResult: &apos;TEST_RESULT&apos;};

      if (fnName == &apos;downloadFile&apos;) {
        var expectedArgs = {
          method: &apos;download&apos;,
          file: args[0]
        };
      }
      else if(fnName === &apos;uploadFile&apos;) {
        var expectedArgs = {
          provider: args[0],
          method: &apos;upload&apos;,
          file: args[1],
          fileName: args[2],
          dir: args[3]
        }
      }

      // Set up plugin hooks
      plugin.preRequest = function(requestArgs) {
        assert.equal(++step, 1, &apos;preRequest hook should be called first&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 3, &apos;preRequest promise should resolve third&apos;);
            // TODO
          });
      };
      plugin.fileRequest = function(requestArgs) {
        assert.equal(++step, 4, &apos;request hook should be called fourth&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return Promise.resolve()
          .then(function() {
            assert.equal(++step, 5, &apos;request promise should resolve fifth&apos;);
            return testResult;
          });
      };
      plugin.wrapFileRequestPromise = function(promise, requestArgs) {
        assert.equal(++step, 2, &apos;wrapFileRequestPromise hook should be called second&apos;);
        assert.deepEqual(requestArgs, expectedArgs, &apos;Request hook arguments match expected arguments&apos;);
        return promise.then(function(result) {
          assert.equal(++step, 6, &apos;wrapFileRequestPromise post-result promise should resolve sixth&apos;);
          assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
          return result;
        });
      };

      var formio = new Formio(formUrl);
      formio[fnName].apply(null, args)
        .then(function(result) {
          assert.equal(++step, 7, &apos;post request promise should resolve last&apos;);
          assert.deepEqual(result, testResult, &apos;Result should match result from request hook&apos;);
          done();
        });
    });
  };

  var fileTests = [
    {
      fnName: &apos;uploadFile&apos;,
      formUrl: &apos;https://api.localhost:3000/project/123/form/123&apos;,
      args: [
        &apos;s3&apos;,
        &apos;FILE&apos;,
        &apos;file.jpg&apos;,
        &apos;dir/&apos;
      ]
    },
    {
      fnName: &apos;uploadFile&apos;,
      formUrl: &apos;https://api.localhost:3000/project/123/form/123&apos;,
      args: [
        &apos;dropbox&apos;,
        &apos;FILE&apos;,
        &apos;file.jpg&apos;,
        &apos;dir/&apos;
      ]
    },
    {
      fnName: &apos;downloadFile&apos;,
      formUrl: &apos;https://api.localhost:3000/project/123/form/123&apos;,
      args: [
        {
          storage: &apos;s3&apos;,
          name: &apos;test&apos;
        }
      ]
    },
    {
      fnName: &apos;downloadFile&apos;,
      formUrl: &apos;https://api.localhost:3000/project/123/form/123&apos;,
      args: [
        {
          storage: &apos;dropbox&apos;,
          name: &apos;test&apos;
        }
      ]
    }
  ];

  fileTests.forEach(function(test) {
    testFileRequest(test.fnName, test.formUrl, test.args);
  });
});
describe(&apos;Test Formio.js capabilities&apos;, () =&gt; {
  var testCapability = function(test) {
    it(test.name, function(done) {
      if (test.mock) {
        var mock = test.mock();
        if (mock instanceof Array) {
          _.each(mock, (_mock) =&gt; {
            fetchMock.mock(_mock.url, _mock.method, _mock.response);
          });
        }
        else {
          fetchMock.mock(mock.url, mock.method, mock.response);
        }
      }
      Promise.resolve()
        .then(function() {
          return test.test();
        })
        .then(function() {
          if (test.mock) fetchMock.restore();
          done();
        })
        .catch(function(err) {
          assert.equal(err, null, &apos;Caught error during test&apos;);
          if (err) console.error(err.stack);
          if (test.mock) fetchMock.restore();
          done();
        });
    });
  };

  var user;
  var userPassword;
  var userToken = chance.string({length: 450});
  var userFormId = generateID();
  var project;
  var form;
  var submission;

  var tests = [
    {
      name: &apos;Registering user.&apos;,
      test: function() {
        var req = {
          data: {
            &apos;user.name&apos;: chance.string({
              length: 10,
              pool: &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;
            }),
            &apos;user.email&apos;: chance.email(),
            &apos;user.password&apos;: chance.string({length: 12})
          }
        };
        var formio = new Formio(Formio.getBaseUrl() + &apos;/user/register&apos;);
        return formio.saveSubmission(req)
          .then(function(response) {
            assert.deepEqual(response, user, &apos;saveSubmission response should match test user&apos;);
            assert.equal(Formio.getToken(), userToken, &apos;Formio should save the user token&apos;);
          });
      },
      mock: function() {
        return [
          {
            url: Formio.getBaseUrl() + &apos;/current&apos;,
            method: &apos;GET&apos;,
            response: function() {
              return {
                headers: {
                  &apos;Content-Type&apos;: &apos;application/json&apos;,
                  &apos;x-jwt-token&apos;: userToken
                },
                body: user
              };
            }
          },
          {
            url: Formio.getBaseUrl() + &apos;/user/register/submission&apos;,
            method: &apos;POST&apos;,
            response: function(url, opts) {
              var body = JSON.parse(opts.body);
              var userId = generateID();
              user = {
                _id: userId,
                created: new Date().toISOString(),
                modified: new Date().toISOString(),
                data: {
                  email: body.data[&apos;user.email&apos;],
                  name: body.data[&apos;user.name&apos;]
                },
                externalIds: [],
                externalTokens: [],
                form: userFormId,
                owner: userId
              };
              userPassword = body.data[&apos;user.password&apos;];
              return {
                headers: {
                  &apos;Content-Type&apos;: &apos;application/json&apos;,
                  &apos;x-jwt-token&apos;: userToken
                },
                body: user
              };
            }
          }
        ];
      }
    },
    {
      name: &apos;Logging in.&apos;,
      test: function() {
        var req = {
          data: {
            &apos;user.email&apos;: user.data.email,
            &apos;user.password&apos;: userPassword
          }
        };
        var formio = new Formio(Formio.getBaseUrl() + &apos;/user/login&apos;);
        return formio.saveSubmission(req)
          .then(function(response) {
            assert.deepEqual(response, user, &apos;saveSubmission response should match test user&apos;);
            assert.equal(Formio.getToken(), userToken, &apos;Formio should save the user token&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/user/login/submission&apos;,
          method: &apos;POST&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            userToken = chance.string({length: 450});
            assert.equal(body.data[&apos;user.email&apos;], user.data.email, &apos;Login email must be correct.&apos;);
            assert.equal(body.data[&apos;user.password&apos;], userPassword, &apos;Login password must be correct.&apos;);
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: user
            };
          }
        };
      }
    },
    {
      name: &apos;Current user.&apos;,
      test: function() {
        return Formio.currentUser()
          .then(function(response) {
            assert.deepEqual(response, user, &apos;currentUser response should match test user&apos;);
            return Formio.currentUser();
          })
          .then(function(response) {
            assert.deepEqual(response, user, &apos;currentUser response should match test user&apos;);
          });
      },
      mock: function() {
        var called = false;
        return {
          url: Formio.getBaseUrl() + &apos;/current&apos;,
          method: &apos;GET&apos;,
          response: function() {
            assert.ok(!called, &apos;User should be requested only once.&apos;);
            called = true;
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: user
            };
          }
        };
      }
    },
    {
      name: &apos;Create Project&apos;,
      test: function() {
        var formio = new Formio();
        var req = {
          title: chance.string({
            length: 10,
            pool: &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;
          }),
          name: chance.string({
            length: 10,
            pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
          }),
          description: chance.paragraph({sentences: 1}),
          settings: {
            cors: &apos;*&apos;
          },
          template: &apos;http://help.form.io/templates/empty.json&apos;
        };
        return formio.saveProject(req)
          .then(function(response) {
            assert.deepEqual(response, project, &apos;saveProject response should match test user&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project&apos;,
          method: &apos;POST&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            var projectId = generateID();
            project = {
              _id: projectId,
              created: new Date().toISOString(),
              modified: new Date().toISOString(),
              apiCalls: {
                used: 0,
                limit: 1000,
                remaining: 1000,
                reset: new Date(Date.now() + 2.628e9).toISOString() // ~1 month later
              },
              access: [],
              title: body.title,
              name: body.name,
              description: body.description,
              plan: &apos;basic&apos;,
              owner: user._id
            };
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: project
            };
          }
        };
      }
    },
    {
      name: &apos;Getting Projects&apos;,
      test: function() {
        return Formio.loadProjects()
          .then(function(projects) {
            assert.equal(projects.length, 1, &apos;Should return only one project.&apos;);
            assert.equal(projects.skip, 0, &apos;skip should be 0.&apos;);
            assert.equal(projects.limit, 1, &apos;limit should be 1.&apos;);
            assert.equal(projects.serverCount, 1, &apos;serverCount should be 1.&apos;);
            assert.deepEqual(projects[0], project, &apos;Should match project&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project&apos;,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;Content-Range&apos;: &apos;0-0/1&apos;,
                &apos;Range-Unit&apos;: &apos;items&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: [project]
            };
          }
        };
      }
    },
    {
      name: &apos;Read Project&apos;,
      test: function() {
        var formio = new Formio(Formio.getBaseUrl() + &apos;/project/&apos; + project._id);
        return formio.loadProject()
          .then(function(response) {
            assert.deepEqual(response, project, &apos;Should match project&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: project
            };
          }
        };
      }
    },
    {
      name: &apos;Update Project&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id);
        var newProject = _.cloneDeep(project);
        newProject.name = chance.string({
          length: 10,
          pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
        });
        newProject.title = chance.string({
          length: 10,
          pool: &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;
        });
        newProject.description = chance.paragraph({sentences: 1});
        return formio.saveProject(newProject)
          .then(function(response) {
            assert.deepEqual(response, project, &apos;Project should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id,
          method: &apos;PUT&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            project = body;
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: project
            };
          }
        };
      }
    },
    {
      name: &apos;Create Form&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form&apos;);
        var req = {
          title: chance.string({
            length: 10,
            pool: &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;
          }),
          name: chance.string({
            length: 10,
            pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
          }),
          path: chance.string({
            length: 10,
            pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
          }),
          components: [
            {
              defaultValue: &apos;&apos;,
              input: true,
              inputMask: &apos;&apos;,
              inputType: &apos;text&apos;,
              isNew: false,
              key: &apos;fieldLabel&apos;,
              label: &apos;Field Label&apos;,
              multiple: false,
              persistent: true,
              placeholder: &apos;&apos;,
              prefix: &apos;&apos;,
              protected: false,
              suffix: &apos;&apos;,
              tableView: true,
              type: &apos;textfield&apos;,
              unique: false,
              validate: {
                required: false,
                minLength: &apos;&apos;,
                maxLength: &apos;&apos;,
                pattern: &apos;&apos;,
                custom: &apos;&apos;,
                customPrivate: false
              }
            },
            {
              action: &apos;submit&apos;,
              block: false,
              disableOnInvalid: true,
              input: true,
              key: &apos;submit&apos;,
              label: &apos;Submit&apos;,
              leftIcon: &apos;&apos;,
              rightIcon: &apos;&apos;,
              size: &apos;md&apos;,
              tableView: false,
              theme: &apos;primary&apos;,
              type: &apos;button&apos;
            }
          ],
          type: &apos;form&apos;,
          access: [],
          submissionAccess: []
        };
        return formio.saveForm(req)
          .then(function(response) {
            assert.deepEqual(response, form, &apos;Form should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form&apos;,
          method: &apos;POST&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            var formId = generateID();
            form = _.cloneDeep(body);
            _.assign(form, {
              _id: formId,
              created: new Date().toISOString(),
              modified: new Date().toISOString(),
              project: project._id,
              owner: user._id
            });
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: form
            };
          }
        };
      }
    },
    {
      name: &apos;Load Forms&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form&apos;);
        return formio.loadForms()
          .then(function(forms) {
            assert.equal(forms.length, 1, &apos;Should return only one form.&apos;);
            assert.equal(forms.skip, 0, &apos;skip should be 0.&apos;);
            assert.equal(forms.limit, 1, &apos;limit should be 1.&apos;);
            assert.equal(forms.serverCount, 1, &apos;serverCount should be 1.&apos;);
            assert.deepEqual(forms[0], form, &apos;Should match form&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form&apos;,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;Content-Range&apos;: &apos;0-0/1&apos;,
                &apos;Range-Unit&apos;: &apos;items&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: [form]
            };
          }
        };
      }
    },
    {
      name: &apos;Read Form&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id);
        return formio.loadForm()
          .then(function(response) {
            assert.deepEqual(response, form, &apos;Form should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: form
            };
          }
        };
      }
    },
    {
      name: &apos;Update Form&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id);
        var newForm = _.cloneDeep(form);
        newForm.title = chance.string({
          length: 10,
          pool: &apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&apos;
        });
        newForm.name = chance.string({
          length: 10,
          pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
        });
        newForm.path = chance.string({
          length: 10,
          pool: &apos;abcdefghijklmnopqrstuvwxyz&apos;
        });
        return formio.saveForm(newForm)
          .then(function(response) {
            assert.deepEqual(response, form, &apos;Form should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id,
          method: &apos;PUT&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            form = body;
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: form
            };
          }
        };
      }
    },
    {
      name: &apos;Create Submission&apos;,
      test: function () {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission&apos;);
        var req = {
          data: {
            fieldLabel: chance.string()
          }
        };
        return formio.saveSubmission(req)
          .then(function(response) {
            assert.deepEqual(response, submission, &apos;Submission should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission&apos;,
          method: &apos;POST&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            var submissionId = generateID();
            submission = {
              _id: submissionId,
              created: new Date().toISOString(),
              modified: new Date().toISOString(),
              data: body.data,
              externalIds: [],
              externalTokens: [],
              form: form._id,
              owner: user._id,
              roles: []
            };
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: submission
            };
          }
        };
      }
    },
    {
      name: &apos;Load Submissions&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission&apos;);
        return formio.loadSubmissions()
          .then(function(submissions) {
            assert.equal(submissions.length, 1, &apos;Should return only one submission.&apos;);
            assert.equal(submissions.skip, 0, &apos;skip should be 0.&apos;);
            assert.equal(submissions.limit, 1, &apos;limit should be 1.&apos;);
            assert.equal(submissions.serverCount, 1, &apos;serverCount should be 1.&apos;);
            assert.deepEqual(submissions[0], submission, &apos;Should match submission&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission&apos;,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;Content-Range&apos;: &apos;0-0/1&apos;,
                &apos;Range-Unit&apos;: &apos;items&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: [submission]
            };
          }
        };
      }
    },
    {
      name: &apos;Read Submission&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id);
        return formio.loadSubmission()
          .then(function(response) {
            assert.deepEqual(response, submission, &apos;Submission should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: submission
            };
          }
        };
      }
    },
    {
      name: &apos;Update Submission&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id);
        var newSubmission = _.cloneDeep(submission);
        newSubmission.data.fieldLabel = chance.string();
        return formio.saveSubmission(newSubmission)
          .then(function(response) {
            assert.deepEqual(response, submission, &apos;Submission should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id,
          method: &apos;PUT&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            submission = body;
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: submission
            };
          }
        };
      }
    },
    {
      name: &apos;Update Submission without ID&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id);
        var newSubmission = _.cloneDeep(submission);
        newSubmission.data.fieldLabel = chance.string();
        return formio.saveSubmission(newSubmission)
          .then(function(response) {
            assert.deepEqual(response, submission, &apos;Submission should match&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id,
          method: &apos;PUT&apos;,
          response: function(url, opts) {
            var body = JSON.parse(opts.body);
            submission = body;
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: submission
            };
          }
        };
      }
    },
    // // Actions
    // // Available Actions
    // // Action Info
    {
      name: &apos;Delete Submission&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id);
        return formio.deleteSubmission()
          .then(function(response) {
            assert.equal(response, &apos;OK&apos;, &apos;Submission should be deleted.&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id + &apos;/submission/&apos; + submission._id,
          method: &apos;DELETE&apos;,
          response: {
            status: 200,
            body: &apos;OK&apos;,
            headers: {
              &apos;Content-Type&apos;: &apos;text/plain; charset=utf-8&apos;,
              &apos;x-jwt-token&apos;: userToken
            }
          }
        };
      }
    },
    {
      name: &apos;Delete Form&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id);
        return formio.deleteForm()
          .then(function(response) {
            assert.equal(response, &apos;OK&apos;, &apos;Submission should be deleted.&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/form/&apos; + form._id,
          method: &apos;DELETE&apos;,
          response: {
            status: 200,
            body: &apos;OK&apos;,
            headers: {
              &apos;Content-Type&apos;: &apos;text/plain; charset=utf-8&apos;,
              &apos;x-jwt-token&apos;: userToken
            }
          }
        };
      }
    },
    {
      name: &apos;Delete Project&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id);
        return formio.deleteProject()
          .then(function(response) {
            assert.equal(response, &apos;OK&apos;, &apos;Submission should be deleted.&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id,
          method: &apos;DELETE&apos;,
          response: {
            status: 200,
            body: &apos;OK&apos;,
            headers: {
              &apos;Content-Type&apos;: &apos;text/plain; charset=utf-8&apos;,
              &apos;x-jwt-token&apos;: userToken
            }
          }
        };
      }
    },
    {
      name: &apos;Getting Projects&apos;,
      test: function() {
        return Formio.loadProjects()
          .then(function(projects) {
            assert.equal(projects.length, 0, &apos;Should return no projects.&apos;);
            assert.equal(projects.skip, undefined, &apos;skip should be undefined.&apos;);
            assert.equal(projects.limit, undefined, &apos;limit should be undefined.&apos;);
            assert.equal(projects.serverCount, 0, &apos;serverCount should be 0.&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project&apos;,
          method: &apos;GET&apos;,
          response: function() {
            return {
              headers: {
                &apos;Content-Type&apos;: &apos;application/json&apos;,
                &apos;Content-Range&apos;: &apos;*/0&apos;,
                &apos;Range-Unit&apos;: &apos;items&apos;,
                &apos;x-jwt-token&apos;: userToken
              },
              body: []
            };
          }
        };
      }
    },
    {
      name: &apos;Temporary Token&apos;,
      test: function() {
        var formio = new Formio(&apos;/project/&apos; + project._id);
        return formio.getTempToken(200, &apos;GET:/current&apos;).then(function(tempToken) {
          assert.equal(tempToken, userToken);
        });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/project/&apos; + project._id + &apos;/token&apos;,
          method: &apos;GET&apos;,
          response: function() {
            return {
              status: 200,
              body: userToken,
              headers: {
                &apos;Content-Type&apos;: &apos;text/plain; charset=utf-8&apos;,
                &apos;x-jwt-token&apos;: userToken
              }
            };
          }
        };
      }
    },
    {
      name: &apos;Logging Out&apos;,
      test: function() {
        return Formio.logout()
          .then(function() {
            assert.equal(Formio.getToken(), &apos;&apos;, &apos;Logged out&apos;);
          });
      },
      mock: function() {
        return {
          url: Formio.getBaseUrl() + &apos;/logout&apos;,
          method: &apos;GET&apos;,
          response: function() {
            userToken = null;
            return {
              status: 200,
              body: &apos;OK&apos;,
              headers: {
                &apos;Content-Type&apos;: &apos;text/plain; charset=utf-8&apos;,
                &apos;x-jwt-token&apos;: &apos;&apos;
              }
            };
          }
        };
      }
    }
  ];

  tests.forEach(testCapability);
});
describe(&apos;Formio.currentUser&apos;, () =&gt; {
  var plugin = null;
  beforeEach(function() {
    plugin = {
      wrapStaticRequestPromise: sinon.spy(function(promise, promiseArgs) {
        return promise;
      }),
      staticRequest: sinon.spy(function() {
        // Return dummy user
        var userId = generateID();
        return Promise.resolve({
          _id: userId,
          created: new Date().toISOString(),
          modified: new Date().toISOString(),
          data: {
            email: &apos;user@place.com&apos;,
            name: &apos;user&apos;
          },
          externalIds: [],
          externalTokens: [],
          form: generateID(),
          owner: userId
        });
      })
    };
    Formio.registerPlugin(plugin, &apos;currentUserTestPlugin&apos;);
  });

  afterEach(function() {
    Formio.deregisterPlugin(plugin);
  });

  it(&apos;Initial currentUser() should make static request&apos;, function(done) {
    // Force token
    Formio.token = chance.string({length: 30});
    Formio.currentUser()
      .then(function() {
        assert.ok(plugin.staticRequest.calledOnce, &apos;staticRequest should be called once&apos;);
        done();
      })
    assert.ok(plugin.wrapStaticRequestPromise.calledOnce, &apos;wrapStaticRequestPromise should be called once&apos;);
  });

  it(&apos;Next currentUser() should return cached value&apos;, function(done) {
    // Clear token
    Formio.currentUser()
      .then(function() {
        assert.ok(!plugin.staticRequest.called, &apos;staticRequest should not be called&apos;);
        done();
      })
    assert.ok(plugin.wrapStaticRequestPromise.calledOnce, &apos;wrapStaticRequestPromise should be called once&apos;);
  });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
